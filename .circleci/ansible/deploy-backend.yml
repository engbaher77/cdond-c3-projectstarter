---

- name: "configuration play." 
  hosts: web
  user: ubuntu
  gather_facts: false
  vars:
    - ansible_python_interpreter: /usr/bin/python3
    - ansible_host_key_checking: false
    - ansible_stdout_callback: yaml


- name: "updadte apt packages"
  become: true
  become_method: sudo
  apt:
    update_cache: yes

- name: "Remove dependencies that are no longer required"
  become: true
  apt:
    autoremove: yes


- name: "updadte apt packages"
  become: true
  become_method: sudo
  apt:
    update_cache: yes

- name: "Remove dependencies that are no longer required"
  become: true
  apt:
    autoremove: yes


- name: "install dependencies."
  become: true
  apt:
    name: ["nodejs", "npm"]
    state: latest
    update_cache: yes

- name: Executing node
  shell: |
    cd backend
    npm i
    npm run build
    cd ..
    cp backend ./circleci/ansible/roles/deploy/files
    cd ./circleci/ansible/roles/deploy/files
    ls

  roles:
    - deploy

  # cd backend
  # npm i
  # npm run build
  # cd ..
  # # Zip the directory
  # tar -C backend -czvf artifact.tar.gz .
  # cd .circleci/ansible